<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>

  <meta name="description" content="사용자는 개발자가 아니다. 개발자가 원하는 대로 데이터를 입력한다는 보장은 없다. 어쩌면 해커일 수도 있다. 잘못된 데이터로 부터 서비스를 보호하는 방법이 필요하고, 서비스(데이터)에 변경이 발생하는 사용자의 요청은 무조건 유효성 검사를 해야 한다."/>
  <meta name="google-site-verification" content="ToXKBimREnz49pDNot4b-N9ZJgYcKXPPsHsjhg4Zzuc"/>
  <meta name="naver-site-verification" content="7cebcc8e5493169f5401870d9ce57f48d18491cd"/>

  <meta name="msapplication-tap-highlight" content="no"/>

  <!-- Facebook Meta -->
  <meta property="og:title" content="라라벨 5 입문 및 실전 / 23강 - 입력 값 유효성 검사"/>
  <meta property="og:type" content="Website"/>
  <meta property="og:author" content="appkr (juwonkim@me.com)"/>
  <meta property="og:image" content=""/>

  <!-- Google+ Meta -->
  <meta itemprop="name" content="라라벨 5 입문 및 실전 / 23강 - 입력 값 유효성 검사">
  <meta itemprop="description" content="사용자는 개발자가 아니다. 개발자가 원하는 대로 데이터를 입력한다는 보장은 없다. 어쩌면 해커일 수도 있다. 잘못된 데이터로 부터 서비스를 보호하는 방법이 필요하고, 서비스(데이터)에 변경이 발생하는 사용자의 요청은 무조건 유효성 검사를 해야 한다.">
  <meta itemprop="image" content="">
  <meta itemprop="author" content="appkr (juwonkim@me.com)"/>

  <!-- Twitter Meta -->
  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:site" content="@appkrs"/>
  <meta name="twitter:title" content="라라벨 5 입문 및 실전 / 23강 - 입력 값 유효성 검사"/>
  <meta name="twitter:description" content="사용자는 개발자가 아니다. 개발자가 원하는 대로 데이터를 입력한다는 보장은 없다. 어쩌면 해커일 수도 있다. 잘못된 데이터로 부터 서비스를 보호하는 방법이 필요하고, 서비스(데이터)에 변경이 발생하는 사용자의 요청은 무조건 유효성 검사를 해야 한다."/>
  <meta name="twitter:image" content=""/>
  <meta name="twitter:domain" content="http://l5.appkr.kr/">

  <!-- Mobile and Rss -->
  <link rel="canonical" href="http://l5.appkr.kr/"/>

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700"/>
  <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/nanumgothic.css"/>
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons"/>
  <link rel="stylesheet" href="/css/main.css">

  <title>라라벨 5 입문 및 실전 / 23강 - 입력 값 유효성 검사</title>

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body id="#app">
  <nav class="navbar navbar-fixed-top role="navigation">

  <div class="container-fluid">
    <div class="navbar-header">
      <a href="/" class="navbar-brand">
        <i class="material-icons">school</i>
        라라벨 5 입문 및 실전
      </a>
    </div>
  </div>
</nav>
  <div class="container">
    <div class="row">
      <aside id="sidebar" class="col-md-3">
        <ul>
                      <li  index="0" current-index="24">
              <a href="/lessons/01-welcome.html">1강 - 처음 만나는 라라벨</a>
            </li>
                      <li  index="1" current-index="24">
              <a href="/lessons/02-hello-laravel.html">2강 - 라라벨 5 설치하기</a>
            </li>
                      <li  index="2" current-index="24">
              <a href="/lessons/02-install-on-windows.html">2강 - 라라벨 5 설치하기 (on Windows)</a>
            </li>
                      <li  index="3" current-index="24">
              <a href="/lessons/03-configuration.html">3강 - 글로벌 설정 살펴보기</a>
            </li>
                      <li  index="4" current-index="24">
              <a href="/lessons/04-routing-basics.html">4강 - Routing 기본기</a>
            </li>
                      <li  index="5" current-index="24">
              <a href="/lessons/05-pass-data-to-view.html">5강 - 뷰에 데이터 바인딩하기</a>
            </li>
                      <li  index="6" current-index="24">
              <a href="/lessons/06-blade-101.html">6강 - 블레이드 101</a>
            </li>
                      <li  index="7" current-index="24">
              <a href="/lessons/07-blade-201.html">7강 - 블레이드 201</a>
            </li>
                      <li  index="8" current-index="24">
              <a href="/lessons/08-raw-queries.html">8강 - 날 쿼리 :(</a>
            </li>
                      <li  index="9" current-index="24">
              <a href="/lessons/09-query-builder.html">9강 - 쿼리 빌더</a>
            </li>
                      <li  index="10" current-index="24">
              <a href="/lessons/10-eloquent.html">10강 - 엘로퀀트 ORM</a>
            </li>
                      <li  index="11" current-index="24">
              <a href="/lessons/11-migration.html">11강 - DB 마이그레이션</a>
            </li>
                      <li  index="12" current-index="24">
              <a href="/lessons/12-controller.html">12강 - 컨트롤러</a>
            </li>
                      <li  index="13" current-index="24">
              <a href="/lessons/13-restful-resource-controller.html">13강 - RESTful 리소스 컨트롤러</a>
            </li>
                      <li  index="14" current-index="24">
              <a href="/lessons/14-named-routes.html">14강 - 이름 있는 Route</a>
            </li>
                      <li  index="15" current-index="24">
              <a href="/lessons/15-nested-resources.html">15강 - 중첩된 리소스</a>
            </li>
                      <li  index="16" current-index="24">
              <a href="/lessons/16-authentication.html">16강 - 사용자 인증 기본기</a>
            </li>
                      <li  index="17" current-index="24">
              <a href="/lessons/17-authentication-201.html">17강 - 라라벨에 내장된 사용자 인증</a>
            </li>
                      <li  index="18" current-index="24">
              <a href="/lessons/18-eloquent-relationships.html">18강 - 모델간 관계 맺기</a>
            </li>
                      <li  index="19" current-index="24">
              <a href="/lessons/19-seeder.html">19강 - 데이터 심기</a>
            </li>
                      <li  index="20" current-index="24">
              <a href="/lessons/20-eager-loading.html">20강 - Eager 로딩</a>
            </li>
                      <li  index="21" current-index="24">
              <a href="/lessons/20-1-pagination.html">추가 - 페이징</a>
            </li>
                      <li  index="22" current-index="24">
              <a href="/lessons/21-mail.html">21강 - 메일 보내기</a>
            </li>
                      <li  index="23" current-index="24">
              <a href="/lessons/22-events.html">22강 - 이벤트</a>
            </li>
                      <li class="active" index="24" current-index="24">
              <a href="/lessons/23-validation.html">23강 - 입력 값 유효성 검사</a>
            </li>
                      <li  index="25" current-index="24">
              <a href="/lessons/24-exception-handling.html">24강 - 예외 처리</a>
            </li>
                      <li  index="26" current-index="24">
              <a href="/lessons/25-composer.html">25강 - 컴포저</a>
            </li>
                      <li  index="27" current-index="24">
              <a href="/lessons/26-document-model.html">26강 - Document 모델</a>
            </li>
                      <li  index="28" current-index="24">
              <a href="/lessons/27-document-controller.html">27강 - Document 컨트롤러</a>
            </li>
                      <li  index="29" current-index="24">
              <a href="/lessons/28-cache.html">28강 - Cache</a>
            </li>
                      <li  index="30" current-index="24">
              <a href="/lessons/29-elixir.html">29강 - Elixir, 만병통치약?</a>
            </li>
                      <li  index="31" current-index="24">
              <a href="/lessons/30-final-touch.html">30강 - Debug &amp; Final Touch</a>
            </li>
                      <li  index="32" current-index="24">
              <a href="/lessons/31-forum-features.html">31강 - 포럼 요구사항 기획</a>
            </li>
                      <li  index="33" current-index="24">
              <a href="/lessons/32-login.html">32강 - 사용자 로그인</a>
            </li>
                      <li  index="34" current-index="24">
              <a href="/lessons/33-social-login.html">33강 - 소셜 로그인</a>
            </li>
                      <li  index="35" current-index="24">
              <a href="/lessons/34-role.html">34강 - 사용자 역할</a>
            </li>
                      <li  index="36" current-index="24">
              <a href="/lessons/35-locale.html">35강 - 다국어 지원</a>
            </li>
                      <li  index="37" current-index="24">
              <a href="/lessons/36-models.html">36강 - 마이그레이션과 모델</a>
            </li>
                      <li  index="38" current-index="24">
              <a href="/lessons/37-articles.html">37강 - Article 기능 구현</a>
            </li>
                      <li  index="39" current-index="24">
              <a href="/lessons/38-tags.html">38강 - Tag 기능 구현</a>
            </li>
                      <li  index="40" current-index="24">
              <a href="/lessons/39-attachments.html">39강 - Attachment 기능 구현</a>
            </li>
                      <li  index="41" current-index="24">
              <a href="/lessons/32n33-auth-refactoring.html">32/33 보충 - 인증 리팩토링</a>
            </li>
                      <li  index="42" current-index="24">
              <a href="/lessons/40-comments.html">40강 - Comment 기능 구현</a>
            </li>
                      <li  index="43" current-index="24">
              <a href="/lessons/41-ui-makeup.html">41강 - UI 개선</a>
            </li>
                      <li  index="44" current-index="24">
              <a href="/lessons/42-be-makeup.html">42강 - 서버 사이드 개선</a>
            </li>
                      <li  index="45" current-index="24">
              <a href="/lessons/43-change-note.html">43강 - 변경 사항 알림</a>
            </li>
                      <li  index="46" current-index="24">
              <a href="/lessons/44-api-basic.html">44강 - API 기본기 및 기획</a>
            </li>
                      <li  index="47" current-index="24">
              <a href="/lessons/45-api-big-picture.html">45강 - 기본 구조 잡기</a>
            </li>
                      <li  index="48" current-index="24">
              <a href="/lessons/46-jwt.html">46강 - JWT 를 이용한 인증</a>
            </li>
                      <li  index="49" current-index="24">
              <a href="/lessons/47-dry-refactoring.html">47강 - 중복 제거 리팩토링</a>
            </li>
                      <li  index="50" current-index="24">
              <a href="/lessons/48-all-is-bad.html">48강 - all() is bad</a>
            </li>
                      <li  index="51" current-index="24">
              <a href="/lessons/49-rate-limit.html">49강 - API Rate Limit</a>
            </li>
                      <li  index="52" current-index="24">
              <a href="/lessons/50-id-obfuscation.html">50강 - 리소스 id 난독화</a>
            </li>
                      <li  index="53" current-index="24">
              <a href="/lessons/51-cors.html">51강 - CORS</a>
            </li>
                      <li  index="54" current-index="24">
              <a href="/lessons/52-caching.html">52강 - Caching</a>
            </li>
                      <li  index="55" current-index="24">
              <a href="/lessons/53-partial-response.html">53강 - Partial Response</a>
            </li>
                      <li  index="56" current-index="24">
              <a href="/lessons/54-api-docs.html">54강 - API Documents</a>
            </li>
                      <li  index="57" current-index="24">
              <a href="/lessons/02-install-homestead-osx.html">Homestead 설치 (on Mac)</a>
            </li>
                      <li  index="58" current-index="24">
              <a href="/lessons/02-install-homestead-windows.html">Homestead 설치 (on Windows)</a>
            </li>
                      <li  index="59" current-index="24">
              <a href="/lessons/999-code-release.html">코드 배포</a>
            </li>
                  </ul>
      </aside>

      <div class="col-md-9">
        <article id="article">
                      <nav id="pagination">
  <ul class="pager pager-top">
    <li class="previous ">
      <a href="/lessons/22-events.html">
        <span class="pager-title-sm">
          <i class="material-icons">keyboard_arrow_left</i>
        </span>
        <span class="pager-title">
          22강 - 이벤트
        </span>
      </a>
    </li>
    <li class="next ">
      <a href="/lessons/24-exception-handling.html">
        <span class="pager-title">
          24강 - 예외 처리
        </span>
        <span class="pager-title-sm">
          <i class="material-icons">keyboard_arrow_right</i>
        </span>
      </a>
    </li>
  </ul>
</nav>
            <hr/>

            <h1>23강 - 입력 값 유효성 검사</h1>
<p>항상 듣는 말이다. <strong>&quot;사용자가 입력한 값은 절대 신뢰하지 마라.&quot;</strong> 유효성 검사는 사용자의 악의적인 해킹 시도 또는 잘못된 데이터 입력으로 부터 서비스를 보호하는 기본 중에 기본이므로 굉장히 중요하다. 프론트엔드에서 자바스크립트로 한번 걸렀다고 해도, HTTP 클라이언트를 통해서 직접 요청할 수 있으므로 백엔드에서도 반드시 유효성 검사를 수행해야 한다.</p>
<h2>라라벨이 지원하는 유효성 검사 규칙</h2>
<p>이 예제에서 사용하는 <code>required</code>, <code>min</code> 뿐 아니라, <code>string</code>, <code>confirmed</code>, <code>exists</code>, <code>required_if</code>, 등등등 굉장히 많다. <a href="http://laravel.com/docs/validation#available-validation-rules">공식 문서</a>를 참고하자.</p>
<h2>유효성 검사 레이어를 만들어 보자.</h2>
<p>app/Http/routes.php 를 이용하자. 여러 번 말하지만 학습 목적이며, 실제로는 컨트롤러에 작성되어야 한다.</p>
<pre><code class="language-php">Route::post('posts', function(\Illuminate\Http\Request $request) {
    $rule = [
        'title' =&gt; ['required'], // == 'title' =&gt; 'required'
        'body' =&gt; ['required', 'min:10'] // == 'body' =&gt; 'required|min:10'
    ];

    $validator = Validator::make($request-&gt;all(), $rule);

    if ($validator-&gt;fails()) {
        return redirect('posts/create')-&gt;withErrors($validator)-&gt;withInput();
    }

    return 'Valid &amp; proceed to next job ~';
});

Route::get('posts/create', function() {
    return view('posts.create');
});</code></pre>
<p><code>Validator::make(array $formData, array $rule)</code> 메소드로 <code>Validator</code> 인스턴스를 만든다. 첫번 째 인자는 폼 데이터인데, 예제에서는 <code>$request</code> 인스턴스를 주입하고 <code>$request-&gt;all()</code> 로 접근했다. 두번 째 인자는 유효성 규칙이다. <code>Validator</code> 인스턴스에 대해 <code>fails()</code> 메소드로 if 테스트를 수행하고, 유효성 검사를 통과하지 못했을 경우, 'posts/create' Route로 Redirect 시켰다. 이때, <code>withErrors($validator)</code> 로 Sesson 에 에러 데이터를 굽는다. 또, <code>withInput()</code>으로 Session에 방금 넘겨 받은 폼 데이터를 'posts/create' Route로 돌아갔을 때도 쓸 수 있도록 한다.</p>
<p><strong><code>참고</code></strong> <code>$request</code> 인스턴스 주입 대신, <code>Request::input(string $key)/Input::get(string $key)</code>, <code>Request::all()/Input::all()</code> 과 같이 라라벨 Facade를 이용할 수도 있다. </p>
<h2>폼을 만들자.</h2>
<p>resources/views/posts/create.blade.php 를 만들어 보자.</p>
<pre><code class="language-html">@extends('master')

@section('content')
  &lt;h1&gt;New Post&lt;/h1&gt;
  &lt;hr/&gt;
  &lt;form action="/posts" method="POST"&gt;
    &lt;input type="hidden" name="_token" value="{{ csrf_token() }}"/&gt;

    &lt;div&gt;
      &lt;label for="title"&gt;Title : &lt;/label&gt;
      &lt;input type="text" name="title" id="title" value="{{ old('title') }}"/&gt;
      {!! $errors-&gt;first('title', '&lt;span&gt;:message&lt;/span&gt;') !!}
    &lt;/div&gt;

    &lt;div&gt;
      &lt;label for="body"&gt;Body : &lt;/label&gt;
      &lt;textarea name="body" id="body" cols="30" rows="10"&gt;{{ old('body') }}&lt;/textarea&gt;
      {!! $errors-&gt;first('body', '&lt;span&gt;:message&lt;/span&gt;') !!}
    &lt;/div&gt;

    &lt;div&gt;
      &lt;button type="submit"&gt;Create New Post&lt;/button&gt;
    &lt;/div&gt;
  &lt;/form&gt;
@stop</code></pre>
<p>이 폼에서는 <code>{!! $errors-&gt;first('title', '&lt;span&gt;:message&lt;/span&gt;') !!}</code> 와 같이 블레이드 문법으로 POST 'posts' Route에서 넘겨 받은 <code>$errors</code> 인스턴스에 접근하고 있다. <code>$errors-&gt;all()</code>로 전체 에러 메시지백을 받은 후, 루프를 돌면서 에러를 뿌리는 방법도 있다. <code>$errors</code> 변수는 모든 뷰에서 항상 존재하기 때문에 <code>if (isset($errors))</code> 등과 같은 방어 조치를 할 필요가 없다는 것을 기억해 두자. <code>$errors</code>는 <code>withErrors()</code>에 의해 세션에 구워진 값이다.</p>
<p><code>{{ old(string $key) }}</code> Helper Function 을 사용한 것도 주의 깊게 보자. <code>old()</code>는 이전 입력 값이 Session에 없으면 '' 를 반환하고, 값이 있으면 반환한다. <code>withInput()</code>에 의해 세션에 구워진 값이다.</p>
<h2>테스트 해 보자.</h2>
<p>브라우저에서 'posts/create' Route를 열자. New Post 입력 폼이 열렸을 것이다. Title 입력박스에만 'First Article'이라고만 입력하고, '폼 제출' 버튼을 눌러 보자. 'post/create' <code>$validator-&gt;fails()</code> 블럭에서 'posts/create' Route로 Redirect되면서, Body 텍스트 영역 옆에 에러 메시지가 출력되었을 것이다. Title에 방금 입력했던 값이 폼에 입력되어 있는 것도 확인하자.</p>
<p><strong><code>참고</code></strong> <code>create.blade.php</code> 에서 <code>{{ var_dump(Session::all()) }}</code>을 넣고, 폼 전송을 다시 해 보자.</p>
<h2>다양한 폼 유효성 검사 방법</h2>
<p><a href="http://laravel.com/docs/validation">공식문서</a>를 보면 크게 3가지 유효성 검사 방법을 설명하고 있다.</p>
<ol>
<li><code>Validator</code> 인스턴스를 직접 만드는 방법</li>
<li>컨트롤러에서 기본으로 사용할 수 잇는 <code>validate()</code> 메소드를 이용하는 방법</li>
<li><code>FormRequest</code>를 이용하는 방법</li>
</ol>
<p>1 번은 우리 예제에서 이미 다루었다.</p>
<p>2 번은 모든 컨트롤러가 <code>App\Http\Controllers\Controller</code> 라는 베이스 컨트롤러를 상속하고 있고, 베이스 컨트롤러가 포함하고 있는 <code>ValidatesRequests</code> 트레이트에 정의된 <code>validate()</code> 메소드를 이용하는 방법이다. 사용법은 1번과 거의 유사하다. 메소드의 첫 번째 인자로, 1번 방법에서는 <code>Request::all()</code> 배열을 넘긴 반면, 이 방법에서는 <code>Illuminate\Http\Request</code> 인스턴스 자체를 넘기면 된다. 많이 하는 질문 중에 하나가 유효성 검사 규칙을 어디에 두어야 하냐는 것인데, 정답은 없다. 컨트롤러에 두어도 되는데, 보통 모델 클래스에 Static 속성으로 정의하는 것을 많이 보았다. 아래 Post 모델과 컨트롤러의 예제를 보자.</p>
<pre><code>// app/Http/routes.php
Route::resource('posts', 'PostsController');

// app/Post.php
class Post extends Model
{
    public static $rules = [
        'title' =&gt; ['required'],
        'body' =&gt; ['required', 'min:10']
    ];
}

// app/Http/Controllers/PostsController.php
class PostsController extends Controller
{
    public function create()
    {
        return view('posts.create');
    }

    public function store(Request $request)
    {
        $this-&gt;validate($request, \App\Post::$rules);

        return '[' . __METHOD__ . '] ' . 'validate the form data from the create form and create a new instance';
    }
}</code></pre>
<p>3 번 Form Request를 이용하는 방법이 가장 깔끔하긴 하다. <a href="http://laravel.com/docs/validation#form-request-validation">공식 문서</a>를 참고하자.</p>
<!--@start-->
<hr />
<ul>
<li><a href="../readme.md">목록으로 돌아가기</a></li>
<li><a href="22-events.md">22강 - 이벤트</a></li>
<li><a href="24-exception-handling.md">24강 - 예외 처리</a>
<!--@end--></li>
</ul>

            <hr/>

            <nav id="pagination">
  <ul class="pager pager-bottom">
    <li class="previous ">
      <a href="/lessons/22-events.html">
        <span class="pager-title-sm">
          <i class="material-icons">keyboard_arrow_left</i>
        </span>
        <span class="pager-title">
          22강 - 이벤트
        </span>
      </a>
    </li>
    <li class="next ">
      <a href="/lessons/24-exception-handling.html">
        <span class="pager-title">
          24강 - 예외 처리
        </span>
        <span class="pager-title-sm">
          <i class="material-icons">keyboard_arrow_right</i>
        </span>
      </a>
    </li>
  </ul>
</nav>                  </article>

        <hr class="divider">

        <div id="comment">
          <div class="comments" style="margin-bottom: 30px;">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//l5lessons.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  <!--script id="dsq-count-scr" src="//l5lessons.disqus.com/count.js" async></script-->
</div>        </div>
      </div>
    </div>
  </div>

  <div id="toggler">
    <a href="#" title="Open Menu">
      목록 토글
    </a>
  </div>

  <footer id="footer">
  <div>
    &copy; 2016 &nbsp; <a href="https://github.com/appkr">appkr</a> •
    Built with <a href="http://jigsaw.tighten.co/">Jigsaw</a> •
    Hosted by <a href="https://pages.github.com/">Github</a> •
    <a href="/feed.xml">Rss</a>
  </div>
</footer>

<div id="back-to-top">
  <a href="#" title="Scroll to Top">
    <i class="material-icons">keyboard_arrow_up</i>
  </a>
</div>
  <script src="/js/all.js"></script>
</body>
</html>
